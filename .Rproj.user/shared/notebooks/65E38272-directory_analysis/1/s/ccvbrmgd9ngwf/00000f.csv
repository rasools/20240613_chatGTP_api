"0","library(httr)"
"0","library(jsonlite)"
"0",""
"0","# Function to list the folder structure and optionally read file contents"
"0","get_folder_structure <- function(dir_path, read_files = FALSE) {"
"0","  folder_structure <- list()"
"0","  files_and_dirs <- list.files(dir_path, full.names = TRUE)"
"0","  "
"0","  for (entry in files_and_dirs) {"
"0","    entry_name <- basename(entry)"
"0","    if (file.info(entry)$isdir) {"
"0","      folder_structure[[entry_name]] <- get_folder_structure(entry, read_files)"
"0","    } else {"
"0","      if (read_files) {"
"0","        file_content <- tryCatch({"
"0","          readLines(entry)"
"0","        }, error = function(e) {"
"0","          paste(""Error reading file:"", e)"
"0","        })"
"0","        folder_structure[[entry_name]] <- paste(file_content, collapse=""\n"")"
"0","      } else {"
"0","        folder_structure[[entry_name]] <- NULL"
"0","      }"
"0","    }"
"0","  }"
"0","  return(folder_structure)"
"0","}"
"0",""
"0","# Function to interact with ChatGPT and retrieve the response"
"0","chat_gpt_interaction <- function(message, api_key, folder_structure = NULL) {"
"0","  url <- ""https://api.openai.com/v1/chat/completions"""
"0","  "
"0","  context_message <- if (!is.null(folder_structure)) {"
"0","    paste(""Here is the folder structure and files:\n"", toJSON(folder_structure, pretty = TRUE), ""\n\nLet's discuss:"")"
"0","  } else {"
"0","    """""
"0","  }"
"0","  "
"0","  body <- list("
"0","    model = ""gpt-3.5-turbo"","
"0","    messages = list("
"0","      list(role = ""system"", content = context_message),  # Context message here"
"0","      list(role = ""user"", content = message)"
"0","    ),"
"0","    max_tokens = 150,"
"0","    n = 1,"
"0","    temperature = 0.7"
"0","  )"
"0","  "
"0","  response <- POST("
"0","    url,"
"0","    add_headers(""Authorization"" = paste(""Bearer"", api_key), ""Content-Type"" = ""application/json""),"
"0","    body = toJSON(body, auto_unbox = TRUE),"
"0","    encode = ""json"""
"0","  )"
"0","  "
"0","  if (status_code(response) != 200) {"
"0","    stop(""API request failed with status code "", status_code(response), "": "", content(response, as = ""text"", encoding = ""UTF-8""))"
"0","  }"
"0","  "
"0","  content <- content(response, as = ""text"", encoding = ""UTF-8"")"
"0","  "
"0","  json_content <- fromJSON(content, flatten = TRUE)"
"0","  "
"0","  if (length(json_content$choices) > 0 && ""message.content"" %in% colnames(json_content$choices)) {"
"0","    response_text <- json_content$choices[1, ""message.content""]"
"0","    total_tokens <- json_content$usage$total_tokens[1]"
"0","  } else {"
"0","    stop(""Unexpected response format from API"")"
"0","  }"
"0","  "
"0","  return(list(response_text = response_text, total_tokens = total_tokens))"
"0","}"
"0",""
"0","# Setup API key from environment for security"
"0","api_key <- Sys.getenv(""OPENAI_API_KEY_NBIS"")"
"0","if (api_key == """") {"
"0","  stop(""API key is not set. Please set the OPENAI_API_KEY_NBIS environment variable."")"
"0","} else {"
"0","  cat(""Successfully retrieved the API key from environment variable.\n"")"
"0","}"
"1","Successfully retrieved the API key from environment variable.
"
"0","# Folder structure for ChatGPT"
"0","dir_path <- ""/Users/rasools/sdrive/projects/LTS_Rockberg/Rockberg_gdrive/LTS_Rockberg_2302_gh""  # Replace with your directory path"
"0","folder_structure <- get_folder_structure(dir_path, read_files = FALSE)"
"0",""
"0","# Initial message for ChatGPT"
"0","initial_message <- ""Let's discuss the types of data available in the project folder."""
"0","message <- initial_message"
"0",""
"0","# Number of exchanges"
"0","num_exchanges <- 6"
"0",""
"0","# Total tokens used"
"0","total_tokens <- 0"
"0",""
"0","# Chat loop"
"0","for (i in 1:num_exchanges) {"
"0","  cat(""You say:\n"", message, ""\n\n"")"
"0","  "
"0","  response <- chat_gpt_interaction(message, api_key, folder_structure)"
"0","  message <- response$response_text"
"0","  total_tokens <- total_tokens + response$total_tokens"
"0","  "
"0","  cat(""ChatGPT says:\n"", message, ""\n\n"")"
"0","  "
"0","  Sys.sleep(1)  # Adding a delay to simulate real-time chatting"
"0","  "
"0","  if (i < num_exchanges) {"
"0","    message <- readline(""Your response: "")"
"0","  }"
"0","}"
"1","You say:
"
"1"," "
"1","Let's discuss the types of data available in the project folder."
"1"," "
"1","

"
"1","ChatGPT says:
"
"1"," "
"1","In the project folder, we have the following types of data available:

1. **Raw Data:**
   - **External:** Located in the `raw_external` folder.
   - **Internal:** Located in the `raw_internal` folder.

2. **Intermediate Data:**
   - **Kallisto Output:** Located in the `intermediate/kallisto_output` folder. This includes subfolders for different samples (e.g., `P15053_101`, `P15053_102`, etc.).

3. **Meta Data:** Located in the `data/meta` folder.

4. **Results Data:**
   - **Figures:** Located in the `results/figures` folder.
   - **Tables:** Located in the"
"1"," "
"1","

"
"0","hi"
"1","You say:
"
"1"," "
"1","hi"
"1"," "
"1","

"
"1","ChatGPT says:
"
"1"," "
"1","Hello! How can I assist you today?"
"1"," "
"1","

"
"0","hi"
"1","You say:
"
"1"," "
"1","hi"
"1"," "
"1","

"
"1","ChatGPT says:
"
"1"," "
"1","Hello! How can I assist you today?"
"1"," "
"1","

"
"0","exit"
"1","You say:
"
"1"," "
"1","exit"
"1"," "
"1","

"
"1","ChatGPT says:
"
"1"," "
"1","Sure, feel free to return if you have any more questions in the future. Have a great day!"
"1"," "
"1","

"
"0","have you looked to the directory?"
"1","You say:
"
"1"," "
"1","have you looked to the directory?"
"1"," "
"1","

"
"1","ChatGPT says:
"
"1"," "
"1","Yes, I have looked into the directory structure and files you provided. What specific information or action would you like to discuss or inquire about regarding the directory?"
"1"," "
"1","

"
"0","what folders we have there?"
"1","You say:
"
"1"," "
"1","what folders we have there?"
"1"," "
"1","

"
"1","ChatGPT says:
"
"1"," "
"1","The folders in the directory structure are as follows:
1. DEA
2. data
3. docs
4. R_project
5. results
6. scripts

Each of these folders contains subfolders and/or files within them."
"1"," "
"1","

"
"0","cat(""Total tokens used: "", total_tokens, ""\n"")"
"1","Total tokens used: "
"1"," "
"1","3561"
"1"," "
"1","
"
